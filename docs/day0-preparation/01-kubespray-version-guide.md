# Kubespray 폐쇄망 운영을 위한 Git 브랜치 및 릴리즈 관리 기준

## 1. 목적

본 문서는 폐쇄망 환경에서 Kubespray를 안정적으로 운영하기 위해 Git 브랜치, 릴리즈, 태그의 의미를 명확히 정의하고, 표준적으로 따라야 할 소스 확보 절차를 정리한다.

---

## 2. Kubespray Git 구조 개요

Kubespray 저장소는 다음 세 가지 개념으로 관리된다.

### 2.1 master 브랜치
- 다음 Kubernetes 마이너 버전을 선행 개발
- 컴포넌트 버전이 수시로 변경됨
- 운영 및 폐쇄망 기준으로 사용하지 않음

### 2.2 release-2.xx 브랜치
- 특정 마이너 릴리즈(예: 2.29)에 대한 유지보수 라인
- 버그픽스 및 차기 패치 버전 변경이 사전 반영됨
- 브랜치는 항상 이동하는 대상(moving target)

### 2.3 v2.xx.y 태그 (중요)
- 공식 릴리즈 시점의 고정 스냅샷
- 릴리즈 노트와 1:1로 대응
- 폐쇄망 및 엔터프라이즈 운영의 유일한 기준선

---

## 3. 브랜치와 태그의 관계 (2.29 예시)

v2.29.1 태그는 공식 릴리즈 시점의 커밋을 가리키며, release-2.29 브랜치는 이후의 유지보수 및 차기 패치 변경을 포함한다.

즉, release 브랜치는 항상 다음 패치 버전의 후보 상태가 될 수 있다.

---

## 4. 운영 원칙 (중요)

### 반드시 지킬 것
- master 브랜치를 운영에 사용하지 않는다
- release 브랜치를 그대로 폐쇄망에 반입하지 않는다
- v2.xx.y 태그 기준으로만 소스를 고정한다
- 릴리즈 노트는 태그 단위로만 신뢰한다

### 하지 말아야 할 것
- 브랜치 이름만 보고 안정성을 판단하는 행위
- checksums.yml만 보고 동일 버전이라고 가정하는 행위
- GitHub의 Download ZIP 기능 사용

---

## 5. 표준 소스 확보 대상 (현 시점)

- 최신 운영 기준: v2.29.1
- 이전 안정 기준: v2.28.1

---

## 6. 인터넷 환경에서의 표준 소스 확보 절차

아래 절차는 **인터넷 연결 환경에서 Kubespray 릴리즈 태그를 기준으로 소스를 확보**하고, 폐쇄망으로 반입하기 위한 표준 예시이다.

### 6.1 저장소 클론 (1회 수행)

```bash
git clone https://github.com/kubernetes-sigs/kubespray.git
cd kubespray
```

- 모든 브랜치 및 태그 메타데이터를 포함한 전체 이력을 확보한다.
- 이후 태그 기반으로만 작업한다.

### 6.2 확보 가능한 태그 확인

```bash
git tag -l "v2.29.*"
git tag -l "v2.28.*"
```

- 운영 대상으로 사용할 정확한 태그 존재 여부를 확인한다.

### 6.3 v2.29.1 기준 소스 고정 및 아카이브 생성

```bash
git checkout v2.29.1
```

```bash
git archive \
  --format=tar.gz \
  --prefix=kubespray-2.29.1/ \
  -o ../kubespray-2.29.1.tar.gz \
  HEAD
```

- detached HEAD 상태는 정상이며, 기준선 고정 목적에 적합하다.
- `.git` 디렉터리는 포함되지 않는다.

### 6.4 v2.28.1 기준 소스 고정 및 아카이브 생성

```bash
git checkout v2.28.1
```

```bash
git archive \
  --format=tar.gz \
  --prefix=kubespray-2.28.1/ \
  -o ../kubespray-2.28.1.tar.gz \
  HEAD
```

---

## 7. 폐쇄망 반입 산출물

- kubespray-2.29.1.tar.gz
- kubespray-2.28.1.tar.gz

위 두 파일만 폐쇄망으로 반입한다.

---

## 8. 내부망 사용 시 주의사항

- kube_version을 명시적으로 고정한다.
- 릴리즈 노트를 기준으로 이미지 및 바이너리 미러를 구성한다.
- 차기 패치 검토 전까지는 소스 기준선을 변경하지 않는다.

---

## 9. 결론

Kubespray 폐쇄망 운영의 기준은 다음과 같다.

릴리즈 노트를 확인하고, 해당 릴리즈 태그(v2.xx.y)를 기준으로 소스를 고정한다.

브랜치는 개발 및 유지보수 흐름을 파악하기 위한 용도일 뿐, 운영 기준선은 항상 태그이다.